(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{554:function(s,t,a){"use strict";a.r(t);var n=a(18),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/saneri/p/10819348.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux expect 介绍和用法"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"what-is-the-expect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-the-expect"}},[s._v("#")]),s._v(" What is the Expect?")]),s._v(" "),a("p",[s._v("Expect 是一个免费的编程工具语言，用来实现自动和交互式任务进行通信，而无需人的干预。expect 就是一套用来实现自动交互功能的软件。")]),s._v(" "),a("p",[s._v("比如说在 shell 脚本中通过 ssh 去登录另一台机器，或者通过 scp 复制文件，等等。就会有交互式界面等待你输入密码，手动输入密码后脚本才能继续执行。很多时候我们不希望在脚本的执行过程中需要人为的干预，比如 CICD。 这时就可以用 Expect 来处理这类问题。")]),s._v(" "),a("h2",{attrs:{id:"installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[s._v("#")]),s._v(" Installation")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or")]),s._v("\ndnf "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"expect-usage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expect-usage"}},[s._v("#")]),s._v(" Expect Usage")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" -help\nusage: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-dDhinNv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-c cmds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("f"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" cmdfile"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  Flags are as follows:\n  -b     prefaces a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" from "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" commands from\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expect reads one line at a timei from the "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  -c     prefaces a "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" to be executed before any "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the script,\n           may be used multiple "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("times")]),s._v("\n  -d     enables diagnostic output\n  -D     enables interactive debugger\n  -f     prefaces a "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" from "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" commands from\n           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("expect reads the whole "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" at once"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  -h     prints this usage message and exits\n  -i     interactively prompts "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" commands\n  -n     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" doesn"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t read personal rc file\n  -N     expect doesn'")]),s._v("t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" system-wide rc "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n  -v     prints version and exits\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("spawn               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 交互程序开始后面跟命令或者指定程序")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取匹配信息匹配成功则执行expect后面的程序动作")]),s._v("\nsend exp_send       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于发送指定的字符串信息")]),s._v("\nexp_continue        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在expect中多次匹配就需要用到")]),s._v("\nsend_user           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用来打印输出 相当于shell中的echo")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出expect脚本")]),s._v("\neof                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# expect执行结束 退出")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义变量")]),s._v("\nputs                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出变量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置超时时间")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"examples"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#examples"}},[s._v("#")]),s._v(" Examples")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.191")]),s._v(".45.148\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FILE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test.zip\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PASSWD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n  spawn scp '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("}")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HOST}")]),s._v(":/admin/home/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FILE}")]),s._v(" .\n  expect {\n    "),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("*assword"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" {set timeout 1000; send "),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PASSWD}")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(";}\n    "),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("yes/no"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" {send "),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("yes"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('; exp_continue;}\n  }\n  expect eof"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("spawn "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" saneri@192.168.56.103 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" -h\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*password"')]),s._v("\nsend "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456'),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("expect")]),s._v(" eof\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);